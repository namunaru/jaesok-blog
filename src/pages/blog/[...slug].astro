---
import { getCollection, render } from 'astro:content';
import "../../styles/blog.css";

/**
 * 1. ì •ì  ê²½ë¡œ ìƒì„±
 */
export async function getStaticPaths() {
  const posts = await getCollection('blog');

  return posts
    .filter(post => !post.data.draft)
    .map(post => ({
      params: { slug: post.slug },
      props: { post },
    }));
}

/**
 * 2. ê°œë³„ ê¸€ ë Œë”ë§
 */
const { post } = Astro.props;

/* ğŸ”¥ í•µì‹¬: html ë¬¸ìì—´ ì§ì ‘ ì‚¬ìš© */
const { html } = await render(post);

/* ğŸ”¥ ë§ˆí¬ë‹¤ìš´ ** ì œê±° */
const cleanHtml = html.replace(/\*\*(.*?)\*\*/g, '$1');

/* ë‚ ì§œ ì•ˆì „ ì²˜ë¦¬ */
const publishedDate = post.data.pubDate
  ? post.data.pubDate.toLocaleDateString()
  : 'ë‚ ì§œ ë¯¸ì •';
---

<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>{post.data.title} | ì¡°ìš©í•œ ì„¸ê³„ë¬¸í•™ ì„œì¬</title>

    <style>
      body {
        font-family: 'serif';
        background-color: #f9f7f2;
        color: #1a1a1a;
        margin: 0;
        line-height: 1.9;
      }

      article {
        max-width: 820px;
        margin: 80px auto;
        padding: 50px 40px;
        background: white;
        border: 1px solid #eee;
      }

      h1 {
        font-size: 2.4rem;
        font-weight: 500;
        margin-bottom: 10px;
        text-align: center;
      }

      .meta {
        color: #888;
        font-size: 0.9rem;
        margin-bottom: 50px;
        text-align: center;
      }

      .content {
        font-size: 1.05rem;
      }

      .content :global(p) {
        margin-bottom: 1.6em;
        text-align: center;
      }

      .content :global(h2) {
        margin-top: 3em;
        margin-bottom: 1em;
        font-size: 1.6rem;
        border-bottom: 1px solid #eee;
        padding-bottom: 10px;
        text-align: center;
      }

      .content :global(blockquote) {
        margin: 2em 0;
        padding-left: 20px;
        color: #555;
        border-left: 3px solid #ddd;
        font-style: italic;
      }

      .back-link {
        display: block;
        margin: 80px auto 0;
        text-align: center;
        text-decoration: none;
        color: #333;
        font-weight: 500;
        border-bottom: 1px solid #ccc;
        width: fit-content;
      }

      .back-link:hover {
        border-bottom-color: #000;
      }
    </style>
  </head>

  <body>
    <article>
      <h1>{post.data.title}</h1>
      <div class="meta">ì‘ì„±ì¼ Â· {publishedDate}</div>

      <!-- ğŸ”¥ í•µì‹¬: ê°€ê³µëœ HTML ì¶œë ¥ -->
      <div class="content" set:html={cleanHtml} />

      <a href="/review" class="back-link">
        â† ë¶ë¦¬ë·° ê²Œì‹œíŒìœ¼ë¡œ ëŒì•„ê°€ê¸°
      </a>
    </article>
  </body>
</html>
