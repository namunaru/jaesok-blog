---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getNotionPosts } from '../lib/notion/posts';

/**
 * Notion 기반 북리뷰 목록
 * - 최신순 정렬
 * - 공개된 글만 노출
 */
const posts = (await getNotionPosts())
  .filter(post => post.published)
  .sort((a, b) => {
    const aTime = a.date ? new Date(a.date).getTime() : 0;
    const bTime = b.date ? new Date(b.date).getTime() : 0;
    return bTime - aTime;
  });
---

<BaseLayout title="북리뷰 | 조용한 세계문학 서재">
  <main class="review-container">
    <header class="review-header">
      <h1>북리뷰</h1>
      <p class="subtitle">
        기록하고, 사유하고, 천천히 공유하는 문학의 흔적
      </p>
    </header>

    {posts.length === 0 ? (
      <p class="empty">아직 등록된 리뷰가 없습니다.</p>
    ) : (
      <ul class="review-list">
        {posts.map(post => (
          <li class="review-item">
            <a class="review-title" href={`/review/${post.slug}`}>
              {post.title}
            </a>

            {post.date && (
              <time class="review-date">
                {new Date(post.date).toLocaleDateString()}
              </time>
            )}
          </li>
        ))}
      </ul>
    )}
  </main>
</BaseLayout>

<style>
  .review-container {
    max-width: 820px;
    margin: 80px auto;
    padding: 0 20px;
  }

  .review-header h1 {
    font-size: 2.4rem;
    font-weight: 500;
    margin-bottom: 10px;
  }

  .subtitle {
    color: #555;
    margin-bottom: 40px;
  }

  .empty {
    color: #999;
  }

  .review-list {
    list-style: none;
    padding: 0;
  }

  .review-item {
    padding: 25px 0;
    border-bottom: 1px solid #e0e0e0;
  }

  .review-item:last-child {
    border-bottom: none;
  }

  .review-title {
    font-size: 1.3rem;
    color: #000;
    text-decoration: none;
    border-bottom: 1px solid transparent;
  }

  .review-title:hover {
    border-bottom-color: #000;
  }

  .review-date {
    display: block;
    margin-top: 8px;
    font-size: 0.85rem;
    color: #888;
  }
</style>
