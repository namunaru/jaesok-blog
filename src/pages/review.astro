---
import BaseLayout from '../layouts/BaseLayout.astro';
// 함수 이름을 getPublishedPosts로 정확히 수정했습니다.
import { getPublishedPosts, mapNotionPageToSchema } from '../lib/notion/posts';

// 1. 노션 데이터 가져오기 (에러 방지 처리)
let posts = [];
try {
  const rawPosts = await getPublishedPosts();
  posts = (rawPosts || []).map(mapNotionPageToSchema);
} catch (error) {
  console.error("북리뷰 목록을 불러오는 중 오류 발생:", error);
}
---

<BaseLayout title="북리뷰 | gedsc">
  <main class="archive-container">
    <header class="page-header">
      <h1 class="serif">북리뷰</h1>
      <p class="subtitle">기록하고, 사유하고, 천천히 공유하는 문학의 흔적</p>
    </header>

    <section class="list-section">
      <div class="post-list">
        {posts.length > 0 ? (
          posts.map((post) => (
            <a href={`/review/${post.id}`} class="post-item">
              <span class="post-title">{post.title}</span>
              <span class="post-date">{post.pubDate.toLocaleDateString('en-US')}</span>
            </a>
          ))
        ) : (
          <p class="empty-msg">아직 기록된 리뷰가 없습니다.</p>
        )}
      </div>
    </section>
  </main>
</BaseLayout>

<style>
  .archive-container {
    max-width: 720px;
    margin: 0 auto;
    padding: 100px 20px;
  }
  .page-header {
    text-align: center;
    margin-bottom: 80px;
  }
  .page-header h1 {
    font-size: 2.2rem;
    margin-bottom: 15px;
  }
  .subtitle {
    color: #888;
    font-size: 1rem;
  }
  .serif {
    font-family: 'Noto Serif KR', serif;
  }
  .post-list {
    display: flex;
    flex-direction: column;
  }
  .post-item {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    padding: 22px 0;
    border-bottom: 1px solid rgba(0, 0, 0, 0.06);
    text-decoration: none;
    color: inherit;
    transition: opacity 0.2s ease;
  }
  .post-item:hover {
    opacity: 0.6;
  }
  .post-title {
    font-size: 1.1rem;
    flex: 1;
    margin-right: 20px;
  }
  .post-date {
    font-size: 0.85rem;
    color: #ccc;
  }
  .empty-msg {
    text-align: center;
    color: #999;
    padding: 100px 0;
  }
</style>