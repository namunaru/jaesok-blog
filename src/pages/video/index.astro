---
// 경로를 반드시 ../../로 유지하세요.
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// 유튜브 썸네일 추출 함수 (메인 페이지와 동일)
function getYouTubeThumbnail(url: string) {
  const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
  const match = url.match(regExp);
  return (match && match[2].length === 11)
    ? `https://img.youtube.com/vi/${match[2]}/maxresdefault.jpg`
    : '/fallback-image.png';
}

const videos = await getCollection('video');
const sortedVideos = videos.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<BaseLayout title="영상리뷰 Archive | Gedsc">
  <div class="theme-beige">
    <section class="page-header-simple">
      <h1 class="serif dark-text">영상리뷰 Archive</h1>
    </section>

    <main class="container">
      <div class="video-grid-archive">
        {sortedVideos.map((video) => (
          <article class="video-item">
            <a href={`/video/${video.slug}`}>
              <div class="thumb-wrap">
                {/* 전체 주소를 함수에 넣어 썸네일 자동 생성 */}
                <img src={getYouTubeThumbnail(video.data.youtube)} alt={video.data.title} />
                <div class="play-icon">▶</div>
              </div>
              <div class="info">
                <h2 class="serif">{video.data.title}</h2>
                <span class="date">{video.data.pubDate.toLocaleDateString('ko-KR')}</span>
              </div>
            </a>
          </article>
        ))}
      </div>
    </main>

    <footer class="site-footer">
      <p>© 2026 gedsc · 세계문학 기록실</p>
    </footer>
  </div>
</BaseLayout>

<style>
  .theme-beige { background: #f9f7f2; min-height: 100vh; color: #1a1a1a; }
  .container { max-width: 1000px; margin: 0 auto; padding: 40px 20px 100px; }
  .dark-text { color: #1a1a1a; }
  .page-header-simple { text-align: center; padding: 80px 0 50px; border-bottom: 1px solid #e0ddd5; margin-bottom: 50px; }
  
  .video-grid-archive { display: grid; grid-template-columns: repeat(2, 1fr); gap: 40px; }
  .thumb-wrap { position: relative; aspect-ratio: 16/9; border-radius: 10px; overflow: hidden; border: 1px solid #e0ddd5; background: #000; }
  .thumb-wrap img { width: 100%; height: 100%; object-fit: cover; opacity: 0.95; transition: 0.4s; }
  .play-icon { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 3rem; opacity: 0; transition: 0.3s; }
  
  .info { padding: 15px 5px; }
  .info h2 { font-size: 1.5rem; margin-top: 8px; transition: 0.3s; line-height: 1.3; }
  .date { font-size: 0.85rem; color: #999; }

  .video-item:hover img { opacity: 0.7; transform: scale(1.03); }
  .video-item:hover .play-icon { opacity: 1; }
  .video-item:hover h2 { color: #b3934d; }
  
  .site-footer { padding: 80px 0; text-align: center; color: #bbb; border-top: 1px solid #e0ddd5; }
  @media (max-width: 768px) { .video-grid-archive { grid-template-columns: 1fr; } }
</style>