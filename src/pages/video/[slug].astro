---
import { getCollection, render } from 'astro:content';

/* =========================
   1. 정적 경로 생성
========================= */
export async function getStaticPaths() {
  const videos = await getCollection('video');

  return videos
    .filter(video => !video.data.draft)
    .map(video => ({
      params: { slug: video.slug },
      props: { video },
    }));
}

/* =========================
   2. 데이터 로드
========================= */
const { video } = Astro.props;
const { Content } = await render(video);

const {
  title,
  description,
  youtubeId,
  pubDate,
} = video.data;
---

<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>{title} · 북영상</title>

    <style>
      body {
        font-family: 'serif';
        background-color: #f9f7f2;
        color: #1a1a1a;
        margin: 0;
        line-height: 1.8;
      }

      nav {
        text-align: center;
        padding: 20px;
        background: white;
        border-bottom: 1px solid #eee;
      }

      nav a {
        margin: 0 12px;
        text-decoration: none;
        color: #333;
        font-weight: 500;
      }

      article {
        max-width: 800px;
        margin: 60px auto;
        padding: 30px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      }

      h1 {
        font-size: 2.4rem;
        margin-bottom: 10px;
      }

      .date {
        color: #888;
        font-size: 0.9rem;
        margin-bottom: 30px;
      }

      .video-wrapper {
        position: relative;
        padding-bottom: 56.25%;
        height: 0;
        margin-bottom: 40px;
      }

      .video-wrapper iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border-radius: 6px;
      }

      .description {
        color: #555;
        margin-bottom: 30px;
        font-style: italic;
      }

      .content {
        margin-top: 30px;
      }

      .back-link {
        display: block;
        margin-top: 50px;
        text-decoration: none;
        color: #333;
        font-weight: bold;
      }
    </style>
  </head>

  <body>
    <nav>
      <a href="/">홈</a>
      <a href="/review">북리뷰</a>
      <a href="/video">북영상</a>
    </nav>

    <article>
      <h1>{title}</h1>

      {pubDate && (
        <p class="date">
          게시일 · {pubDate.toLocaleDateString()}
        </p>
      )}

      {youtubeId && (
        <div class="video-wrapper">
          <iframe
            src={`https://www.youtube.com/embed/${youtubeId}`}
            title={title}
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen
          ></iframe>
        </div>
      )}

      {description && (
        <p class="description">{description}</p>
      )}

      <div class="content">
        <Content />
      </div>

      <a href="/video" class="back-link">← 영상 목록으로 돌아가기</a>
    </article>
  </body>
</html>
