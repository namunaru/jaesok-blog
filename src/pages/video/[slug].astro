---
import { getEntry, render } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import PostNavigation from '../../components/PostNavigation.astro';

const { slug } = Astro.params;

// 1. 해당 slug와 일치하는 영상 데이터 가져오기
const video = await getEntry('video', slug as any);

// 2. 데이터가 없으면 404 페이지로 보냄 (에러 방지)
if (!video) {
  return Astro.redirect('/404');
}

// 3. 마크다운 본문 렌더링
const { Content } = await render(video);
---

<BaseLayout title={`${video.data.title} | jaesok-blog`}>
  <article class="video-post">
    <header>
      <time>{video.data.pubDate?.toLocaleDateString('ko-KR')}</time>
      <h1>{video.data.title}</h1>
    </header>

    <div class="video-container">
      <iframe 
        src={`https://www.youtube.com/embed/${video.data.youtube.split('v=')[1]}`}
        frameborder="0" 
        allowfullscreen
      ></iframe>
    </div>

    <div class="prose">
      <Content />
    </div>

    <PostNavigation />
  </article>
</BaseLayout>

<style>
  .video-post { max-width: 800px; margin: 0 auto; padding: 40px 20px; }
  header { text-align: center; margin-bottom: 40px; }
  header time { color: #888; }
  header h1 { font-size: 2.5rem; margin-top: 10px; }
  .video-container { position: relative; padding-bottom: 56.25%; height: 0; margin-bottom: 40px; }
  .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 12px; }
  .prose { line-height: 1.8; font-size: 1.1rem; }
</style>